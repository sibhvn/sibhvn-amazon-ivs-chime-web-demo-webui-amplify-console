{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAudioInput = exports.createAudioContext = exports.VoiceFocus = void 0;\n\nconst decider_js_1 = require(\"./decider.js\");\n\nconst fetch_js_1 = require(\"./fetch.js\");\n\nconst loader_js_1 = require(\"./loader.js\");\n\nconst support_js_1 = require(\"./support.js\");\n\nconst worklet_inline_node_js_1 = require(\"./worklet-inline-node.js\");\n\nconst worklet_worker_sab_node_js_1 = require(\"./worklet-worker-sab-node.js\");\n\nconst worklet_worker_postMessage_node_js_1 = require(\"./worklet-worker-postMessage-node.js\");\n\nconst DEFAULT_AGC_DISABLED_SETTING = {\n  useVoiceFocusAGC: false,\n  useBuiltInAGC: true\n};\nconst DEFAULT_AGC_SETTING = DEFAULT_AGC_DISABLED_SETTING;\nconst DEFAULT_ASSET_GROUP = 'stable-v1';\nconst DEFAULT_CDN = 'https://static.sdkassets.chime.aws/';\nconst DEFAULT_PATHS = {\n  processors: `${DEFAULT_CDN}processors/`,\n  workers: `${DEFAULT_CDN}workers/`,\n  wasm: `${DEFAULT_CDN}wasm/`,\n  models: `${DEFAULT_CDN}wasm/`\n};\nconst DEFAULT_CONTEXT_HINT = {\n  latencyHint: 0\n};\nconst BASE_AUDIO_CONSTRAINTS = {\n  channelCount: 1,\n  echoCancellation: true,\n  googEchoCancellation: true,\n  noiseSuppression: false,\n  googNoiseSuppression: false,\n  googHighpassFilter: false,\n  googTypingNoiseDetection: false\n};\nconst DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC = Object.assign(Object.assign({}, BASE_AUDIO_CONSTRAINTS), {\n  autoGainControl: true,\n  googAutoGainControl: true,\n  googAutoGainControl2: true\n});\nconst DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC = Object.assign(Object.assign({}, BASE_AUDIO_CONSTRAINTS), {\n  autoGainControl: false,\n  googAutoGainControl: false,\n  googAutoGainControl2: false\n});\nconst PROCESSORS = {\n  'voicefocus-worker-sab-processor': {\n    file: 'worklet-worker-sab-processor-v1.js',\n    node: worklet_worker_sab_node_js_1.default\n  },\n  'voicefocus-worker-postMessage-processor': {\n    file: 'worklet-worker-postMessage-processor-v1.js',\n    node: worklet_worker_postMessage_node_js_1.default\n  },\n  'voicefocus-inline-processor': {\n    file: 'worklet-inline-processor-v1.js',\n    node: worklet_inline_node_js_1.default\n  }\n};\n\nconst validateAssetSpec = (assetGroup, revisionID) => {\n  if (assetGroup !== undefined && !fetch_js_1.isValidAssetGroup(assetGroup)) {\n    throw new Error(`Invalid asset group ${assetGroup}`);\n  }\n\n  if (revisionID !== undefined && !fetch_js_1.isValidRevisionID(revisionID)) {\n    throw new Error(`Invalid revision ID ${revisionID}`);\n  }\n};\n\nconst mungeConstraints = (constraints, agc) => {\n  let defaultConstraints;\n\n  if (agc.useBuiltInAGC) {\n    defaultConstraints = DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC;\n  } else {\n    defaultConstraints = DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC;\n  }\n\n  if (!constraints) {\n    return {\n      audio: defaultConstraints\n    };\n  }\n\n  if (!constraints.audio) {\n    return constraints;\n  }\n\n  if (constraints.video) {\n    throw new Error('Not adding Voice Focus to multi-device getUserMedia call.');\n  }\n\n  return Object.assign(Object.assign({}, constraints), {\n    audio: constraints.audio === true ? defaultConstraints : Object.assign(Object.assign({}, constraints.audio), defaultConstraints)\n  });\n};\n\nconst urlForModel = (model, paths) => {\n  return `${paths.models}${decider_js_1.decideModel(model)}.wasm`;\n};\n\nclass VoiceFocus {\n  constructor(worker, processorURL, nodeConstructor, nodeOptions, executionQuanta) {\n    this.processorURL = processorURL;\n    this.nodeConstructor = nodeConstructor;\n    this.nodeOptions = nodeOptions;\n    this.executionQuanta = executionQuanta;\n    this.internal = {\n      worker,\n      nodeOptions\n    };\n  }\n\n  static isSupported(spec, options) {\n    const {\n      fetchBehavior,\n      logger\n    } = options || {};\n\n    if (typeof globalThis === 'undefined') {\n      logger === null || logger === void 0 ? void 0 : logger.debug('Browser does not have globalThis.');\n      return Promise.resolve(false);\n    }\n\n    if (!support_js_1.supportsAudioWorklet(globalThis, logger)) {\n      logger === null || logger === void 0 ? void 0 : logger.debug('Browser does not support Audio Worklet.');\n      return Promise.resolve(false);\n    }\n\n    if (!support_js_1.supportsWASM(globalThis, logger)) {\n      logger === null || logger === void 0 ? void 0 : logger.debug('Browser does not support WASM.');\n      return Promise.resolve(false);\n    }\n\n    if (!support_js_1.supportsWASMStreaming(globalThis, logger)) {\n      logger === null || logger === void 0 ? void 0 : logger.debug('Browser does not support streaming WASM compilation.');\n    }\n\n    const {\n      assetGroup = DEFAULT_ASSET_GROUP,\n      revisionID,\n      paths = DEFAULT_PATHS\n    } = spec || {};\n    validateAssetSpec(assetGroup, revisionID);\n    const assetConfig = revisionID ? {\n      revisionID\n    } : {\n      assetGroup\n    };\n    const updatedFetchBehavior = fetch_js_1.addQueryParams(fetchBehavior, assetConfig);\n    const fetchConfig = Object.assign(Object.assign({}, updatedFetchBehavior), {\n      paths\n    });\n    return support_js_1.supportsVoiceFocusWorker(globalThis, fetchConfig, logger);\n  }\n\n  static mungeExecutionPreference(preference, logger) {\n    const isAuto = preference === undefined || preference === 'auto';\n\n    if (support_js_1.isSafari(globalThis)) {\n      if (isAuto || preference === 'inline') {\n        return 'inline';\n      }\n\n      if (!isAuto) {\n        throw new Error(`Unsupported execution preference ${preference}`);\n      }\n    }\n\n    if (preference === 'worker-sab' && !support_js_1.supportsSharedArrayBuffer(globalThis, globalThis, logger)) {\n      throw new Error(`Unsupported execution preference ${preference}`);\n    }\n\n    return preference || 'auto';\n  }\n\n  static configure(spec, options) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const {\n        fetchBehavior,\n        preResolve,\n        logger\n      } = options || {};\n      const {\n        category = 'voicefocus',\n        name = 'default',\n        variant: variantPreference = 'auto',\n        assetGroup = DEFAULT_ASSET_GROUP,\n        revisionID,\n        simd = 'detect',\n        executionPreference = 'auto',\n        executionQuantaPreference,\n        usagePreference = 'interactivity',\n        estimatorBudget = 100,\n        paths = DEFAULT_PATHS,\n        thresholds\n      } = spec || {};\n      logger === null || logger === void 0 ? void 0 : logger.debug('Configuring Voice Focus with spec', spec);\n\n      if (category !== undefined && category !== 'voicefocus') {\n        throw new Error(`Unrecognized category ${category}`);\n      }\n\n      if (name !== undefined && name !== 'default' && name !== 'ns_es') {\n        throw new Error(`Unrecognized feature name ${name}`);\n      }\n\n      if (variantPreference !== undefined && !['auto', 'c100', 'c50', 'c20', 'c10'].includes(variantPreference)) {\n        throw new Error(`Unrecognized feature variant ${variantPreference}`);\n      }\n\n      if (executionQuantaPreference !== undefined && ![1, 2, 3].includes(executionQuantaPreference)) {\n        throw new Error(`Unrecognized execution quanta preference ${executionQuantaPreference}`);\n      }\n\n      validateAssetSpec(assetGroup, revisionID);\n\n      if (simd !== undefined && !['detect', 'force', 'disable'].includes(simd)) {\n        throw new Error(`Unrecognized SIMD option ${simd}`);\n      }\n\n      if (executionPreference !== undefined && !['auto', 'inline', 'worker', 'worker-sab', 'worker-postMessage'].includes(executionPreference)) {\n        throw new Error(`Unrecognized execution preference ${executionPreference}`);\n      }\n\n      if (usagePreference !== undefined && !['quality', 'interactivity'].includes(usagePreference)) {\n        throw new Error(`Unrecognized usage preference ${usagePreference}`);\n      }\n\n      const executionSpec = {\n        executionPreference: this.mungeExecutionPreference(executionPreference, logger),\n        usagePreference,\n        executionQuantaPreference,\n        variantPreference,\n        namePreference: name,\n        simdPreference: simd,\n        estimatorBudget\n      };\n      const assetConfig = revisionID ? {\n        revisionID\n      } : {\n        assetGroup\n      };\n      const updatedFetchBehavior = fetch_js_1.addQueryParams(fetchBehavior, assetConfig);\n      const fetchConfig = Object.assign({\n        paths\n      }, updatedFetchBehavior);\n      const executionDefinition = yield decider_js_1.measureAndDecideExecutionApproach(executionSpec, fetchConfig, logger, thresholds);\n\n      if (executionDefinition.supported === false) {\n        return {\n          supported: false,\n          reason: executionDefinition.reason\n        };\n      }\n\n      logger === null || logger === void 0 ? void 0 : logger.info('Decided execution approach', executionDefinition);\n      const {\n        useSIMD,\n        processor,\n        variant,\n        executionQuanta\n      } = executionDefinition;\n      const model = {\n        category: category || 'voicefocus',\n        name: name || 'default',\n        variant,\n        simd: useSIMD\n      };\n\n      if (preResolve) {\n        const startingURL = urlForModel(model, paths);\n        model.url = yield fetch_js_1.resolveURL(startingURL, updatedFetchBehavior);\n      }\n\n      return {\n        fetchConfig,\n        model,\n        processor,\n        executionQuanta,\n        supported: true\n      };\n    });\n  }\n\n  static init(configuration, _ref) {\n    let {\n      delegate,\n      preload = true,\n      logger\n    } = _ref;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (configuration.supported === false) {\n        throw new Error('Voice Focus not supported. Reason: ' + configuration.reason);\n      }\n\n      const {\n        model,\n        processor,\n        fetchConfig,\n        executionQuanta\n      } = configuration;\n      const {\n        simd,\n        name\n      } = model;\n      const {\n        paths\n      } = fetchConfig;\n\n      if (processor !== 'voicefocus-inline-processor' && processor !== 'voicefocus-worker-postMessage-processor' && processor !== 'voicefocus-worker-sab-processor') {\n        throw new Error(`Unknown processor ${processor}`);\n      }\n\n      const modelURL = model.url || urlForModel(model, paths);\n      logger === null || logger === void 0 ? void 0 : logger.debug(`Using model URL ${modelURL}.`);\n      const audioBufferURL = `${paths.wasm}audio_buffer-v1${simd ? '_simd' : ''}.wasm`;\n      const resamplerURL = `${paths.wasm}resampler-v1${simd ? '_simd' : ''}.wasm`;\n      const workerURL = `${paths.workers}worker-v1.js`;\n      const {\n        file,\n        node\n      } = PROCESSORS[processor];\n      const processorURL = `${paths.processors}${file}`;\n      const worker = yield loader_js_1.loadWorker(workerURL, 'VoiceFocusWorker', fetchConfig, logger);\n\n      if (preload) {\n        logger === null || logger === void 0 ? void 0 : logger.debug('Preloading', modelURL);\n        let message = support_js_1.supportsWASMPostMessage(globalThis) ? 'get-module' : 'get-module-buffer';\n        worker.postMessage({\n          message,\n          preload: true,\n          key: 'model',\n          fetchBehavior: fetchConfig,\n          path: modelURL\n        });\n      }\n\n      const numberOfInputs = name === 'ns_es' ? 2 : 1;\n      const nodeOptions = {\n        processor,\n        worker,\n        audioBufferURL,\n        resamplerURL,\n        fetchBehavior: fetchConfig,\n        modelURL,\n        delegate,\n        logger,\n        numberOfInputs\n      };\n      const factory = new VoiceFocus(worker, processorURL, node, nodeOptions, executionQuanta);\n      return Promise.resolve(factory);\n    });\n  }\n\n  createNode(context, options) {\n    var _a;\n\n    const {\n      voiceFocusSampleRate = context.sampleRate === 16000 ? 16000 : 48000,\n      enabled = true,\n      agc = DEFAULT_AGC_SETTING\n    } = options || {};\n    const supportFarendStream = options === null || options === void 0 ? void 0 : options.es;\n    const processorOptions = {\n      voiceFocusSampleRate,\n      enabled,\n      sendBufferCount: 10,\n      prefill: 6,\n      agc,\n      executionQuanta: this.executionQuanta,\n      supportFarendStream\n    };\n    const url = fetch_js_1.withQueryString(this.processorURL, (_a = this.nodeOptions) === null || _a === void 0 ? void 0 : _a.fetchBehavior);\n    return context.audioWorklet.addModule(url).then(() => new this.nodeConstructor(context, Object.assign(Object.assign({}, this.nodeOptions), {\n      processorOptions\n    })));\n  }\n\n  applyToStream(stream, context, options) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const source = context.createMediaStreamSource(stream);\n      const node = yield this.applyToSourceNode(source, context, options);\n      const destination = context.createMediaStreamDestination();\n      node.connect(destination);\n      return {\n        node,\n        source,\n        destination,\n        stream: destination.stream\n      };\n    });\n  }\n\n  applyToSourceNode(source, context, options) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const node = yield this.createNode(context, options);\n      source.connect(node);\n      return node;\n    });\n  }\n\n}\n\nexports.VoiceFocus = VoiceFocus;\n\nconst createAudioContext = function () {\n  let contextHint = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_CONTEXT_HINT;\n  return new (window.AudioContext || window.webkitAudioContext)(contextHint);\n};\n\nexports.createAudioContext = createAudioContext;\n\nconst getAudioInput = (context, inputOptions, voiceFocusOptions) => __awaiter(void 0, void 0, void 0, function* () {\n  var _a, _b;\n\n  const {\n    constraints,\n    spec,\n    delegate,\n    preload = true,\n    options\n  } = inputOptions;\n  const {\n    logger\n  } = voiceFocusOptions;\n  const config = yield VoiceFocus.configure(spec, voiceFocusOptions);\n\n  if (!config.supported) {\n    (_a = voiceFocusOptions.logger) === null || _a === void 0 ? void 0 : _a.warn('Voice Focus not supported; returning standard stream.');\n    return window.navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  const factory = yield VoiceFocus.init(config, {\n    delegate,\n    preload,\n    logger\n  });\n  const agc = ((_b = inputOptions.options) === null || _b === void 0 ? void 0 : _b.agc) || DEFAULT_AGC_SETTING;\n  const input = yield window.navigator.mediaDevices.getUserMedia(mungeConstraints(constraints, agc));\n  return factory.applyToStream(input, context, options).then(result => result.stream);\n});\n\nexports.getAudioInput = getAudioInput;","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","getAudioInput","createAudioContext","VoiceFocus","decider_js_1","require","fetch_js_1","loader_js_1","support_js_1","worklet_inline_node_js_1","worklet_worker_sab_node_js_1","worklet_worker_postMessage_node_js_1","DEFAULT_AGC_DISABLED_SETTING","useVoiceFocusAGC","useBuiltInAGC","DEFAULT_AGC_SETTING","DEFAULT_ASSET_GROUP","DEFAULT_CDN","DEFAULT_PATHS","processors","workers","wasm","models","DEFAULT_CONTEXT_HINT","latencyHint","BASE_AUDIO_CONSTRAINTS","channelCount","echoCancellation","googEchoCancellation","noiseSuppression","googNoiseSuppression","googHighpassFilter","googTypingNoiseDetection","DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC","assign","autoGainControl","googAutoGainControl","googAutoGainControl2","DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC","PROCESSORS","file","node","default","validateAssetSpec","assetGroup","revisionID","undefined","isValidAssetGroup","Error","isValidRevisionID","mungeConstraints","constraints","agc","defaultConstraints","audio","video","urlForModel","model","paths","decideModel","constructor","worker","processorURL","nodeConstructor","nodeOptions","executionQuanta","internal","isSupported","spec","options","fetchBehavior","logger","globalThis","debug","supportsAudioWorklet","supportsWASM","supportsWASMStreaming","assetConfig","updatedFetchBehavior","addQueryParams","fetchConfig","supportsVoiceFocusWorker","mungeExecutionPreference","preference","isAuto","isSafari","supportsSharedArrayBuffer","configure","preResolve","category","name","variant","variantPreference","simd","executionPreference","executionQuantaPreference","usagePreference","estimatorBudget","thresholds","includes","executionSpec","namePreference","simdPreference","executionDefinition","measureAndDecideExecutionApproach","supported","reason","info","useSIMD","processor","startingURL","url","resolveURL","init","configuration","delegate","preload","modelURL","audioBufferURL","resamplerURL","workerURL","loadWorker","message","supportsWASMPostMessage","postMessage","key","path","numberOfInputs","factory","createNode","context","_a","voiceFocusSampleRate","sampleRate","enabled","supportFarendStream","es","processorOptions","sendBufferCount","prefill","withQueryString","audioWorklet","addModule","applyToStream","stream","source","createMediaStreamSource","applyToSourceNode","destination","createMediaStreamDestination","connect","contextHint","window","AudioContext","webkitAudioContext","inputOptions","voiceFocusOptions","_b","config","warn","navigator","mediaDevices","getUserMedia","input"],"sources":["/Users/kshiba01/projects/DXサービス/AWS/amplify/amazon-ivs-chime-web-demo-webui-amplify-console/node_modules/amazon-chime-sdk-js/libs/voicefocus/voicefocus.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getAudioInput = exports.createAudioContext = exports.VoiceFocus = void 0;\nconst decider_js_1 = require(\"./decider.js\");\nconst fetch_js_1 = require(\"./fetch.js\");\nconst loader_js_1 = require(\"./loader.js\");\nconst support_js_1 = require(\"./support.js\");\nconst worklet_inline_node_js_1 = require(\"./worklet-inline-node.js\");\nconst worklet_worker_sab_node_js_1 = require(\"./worklet-worker-sab-node.js\");\nconst worklet_worker_postMessage_node_js_1 = require(\"./worklet-worker-postMessage-node.js\");\nconst DEFAULT_AGC_DISABLED_SETTING = {\n    useVoiceFocusAGC: false,\n    useBuiltInAGC: true,\n};\nconst DEFAULT_AGC_SETTING = DEFAULT_AGC_DISABLED_SETTING;\nconst DEFAULT_ASSET_GROUP = 'stable-v1';\nconst DEFAULT_CDN = 'https://static.sdkassets.chime.aws/';\nconst DEFAULT_PATHS = {\n    processors: `${DEFAULT_CDN}processors/`,\n    workers: `${DEFAULT_CDN}workers/`,\n    wasm: `${DEFAULT_CDN}wasm/`,\n    models: `${DEFAULT_CDN}wasm/`,\n};\nconst DEFAULT_CONTEXT_HINT = {\n    latencyHint: 0,\n};\nconst BASE_AUDIO_CONSTRAINTS = {\n    channelCount: 1,\n    echoCancellation: true,\n    googEchoCancellation: true,\n    noiseSuppression: false,\n    googNoiseSuppression: false,\n    googHighpassFilter: false,\n    googTypingNoiseDetection: false,\n};\nconst DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC = Object.assign(Object.assign({}, BASE_AUDIO_CONSTRAINTS), { autoGainControl: true, googAutoGainControl: true, googAutoGainControl2: true });\nconst DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC = Object.assign(Object.assign({}, BASE_AUDIO_CONSTRAINTS), { autoGainControl: false, googAutoGainControl: false, googAutoGainControl2: false });\nconst PROCESSORS = {\n    'voicefocus-worker-sab-processor': {\n        file: 'worklet-worker-sab-processor-v1.js',\n        node: worklet_worker_sab_node_js_1.default,\n    },\n    'voicefocus-worker-postMessage-processor': {\n        file: 'worklet-worker-postMessage-processor-v1.js',\n        node: worklet_worker_postMessage_node_js_1.default,\n    },\n    'voicefocus-inline-processor': {\n        file: 'worklet-inline-processor-v1.js',\n        node: worklet_inline_node_js_1.default,\n    },\n};\nconst validateAssetSpec = (assetGroup, revisionID) => {\n    if (assetGroup !== undefined && !fetch_js_1.isValidAssetGroup(assetGroup)) {\n        throw new Error(`Invalid asset group ${assetGroup}`);\n    }\n    if (revisionID !== undefined && !fetch_js_1.isValidRevisionID(revisionID)) {\n        throw new Error(`Invalid revision ID ${revisionID}`);\n    }\n};\nconst mungeConstraints = (constraints, agc) => {\n    let defaultConstraints;\n    if (agc.useBuiltInAGC) {\n        defaultConstraints = DEFAULT_AUDIO_CONSTRAINTS_WITH_BUILTIN_AGC;\n    }\n    else {\n        defaultConstraints = DEFAULT_AUDIO_CONSTRAINTS_WITHOUT_BUILTIN_AGC;\n    }\n    if (!constraints) {\n        return { audio: defaultConstraints };\n    }\n    if (!constraints.audio) {\n        return constraints;\n    }\n    if (constraints.video) {\n        throw new Error('Not adding Voice Focus to multi-device getUserMedia call.');\n    }\n    return Object.assign(Object.assign({}, constraints), { audio: constraints.audio === true ? defaultConstraints : Object.assign(Object.assign({}, constraints.audio), defaultConstraints) });\n};\nconst urlForModel = (model, paths) => {\n    return `${paths.models}${decider_js_1.decideModel(model)}.wasm`;\n};\nclass VoiceFocus {\n    constructor(worker, processorURL, nodeConstructor, nodeOptions, executionQuanta) {\n        this.processorURL = processorURL;\n        this.nodeConstructor = nodeConstructor;\n        this.nodeOptions = nodeOptions;\n        this.executionQuanta = executionQuanta;\n        this.internal = {\n            worker,\n            nodeOptions,\n        };\n    }\n    static isSupported(spec, options) {\n        const { fetchBehavior, logger } = options || {};\n        if (typeof globalThis === 'undefined') {\n            logger === null || logger === void 0 ? void 0 : logger.debug('Browser does not have globalThis.');\n            return Promise.resolve(false);\n        }\n        if (!support_js_1.supportsAudioWorklet(globalThis, logger)) {\n            logger === null || logger === void 0 ? void 0 : logger.debug('Browser does not support Audio Worklet.');\n            return Promise.resolve(false);\n        }\n        if (!support_js_1.supportsWASM(globalThis, logger)) {\n            logger === null || logger === void 0 ? void 0 : logger.debug('Browser does not support WASM.');\n            return Promise.resolve(false);\n        }\n        if (!support_js_1.supportsWASMStreaming(globalThis, logger)) {\n            logger === null || logger === void 0 ? void 0 : logger.debug('Browser does not support streaming WASM compilation.');\n        }\n        const { assetGroup = DEFAULT_ASSET_GROUP, revisionID, paths = DEFAULT_PATHS, } = spec || {};\n        validateAssetSpec(assetGroup, revisionID);\n        const assetConfig = revisionID ? { revisionID } : { assetGroup };\n        const updatedFetchBehavior = fetch_js_1.addQueryParams(fetchBehavior, assetConfig);\n        const fetchConfig = Object.assign(Object.assign({}, updatedFetchBehavior), { paths });\n        return support_js_1.supportsVoiceFocusWorker(globalThis, fetchConfig, logger);\n    }\n    static mungeExecutionPreference(preference, logger) {\n        const isAuto = (preference === undefined || preference === 'auto');\n        if (support_js_1.isSafari(globalThis)) {\n            if (isAuto || preference === 'inline') {\n                return 'inline';\n            }\n            if (!isAuto) {\n                throw new Error(`Unsupported execution preference ${preference}`);\n            }\n        }\n        if (preference === 'worker-sab' && !support_js_1.supportsSharedArrayBuffer(globalThis, globalThis, logger)) {\n            throw new Error(`Unsupported execution preference ${preference}`);\n        }\n        return preference || 'auto';\n    }\n    static configure(spec, options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { fetchBehavior, preResolve, logger, } = options || {};\n            const { category = 'voicefocus', name = 'default', variant: variantPreference = 'auto', assetGroup = DEFAULT_ASSET_GROUP, revisionID, simd = 'detect', executionPreference = 'auto', executionQuantaPreference, usagePreference = 'interactivity', estimatorBudget = 100, paths = DEFAULT_PATHS, thresholds, } = spec || {};\n            logger === null || logger === void 0 ? void 0 : logger.debug('Configuring Voice Focus with spec', spec);\n            if (category !== undefined && category !== 'voicefocus') {\n                throw new Error(`Unrecognized category ${category}`);\n            }\n            if (name !== undefined && name !== 'default' && name !== 'ns_es') {\n                throw new Error(`Unrecognized feature name ${name}`);\n            }\n            if (variantPreference !== undefined && !['auto', 'c100', 'c50', 'c20', 'c10'].includes(variantPreference)) {\n                throw new Error(`Unrecognized feature variant ${variantPreference}`);\n            }\n            if (executionQuantaPreference !== undefined && ![1, 2, 3].includes(executionQuantaPreference)) {\n                throw new Error(`Unrecognized execution quanta preference ${executionQuantaPreference}`);\n            }\n            validateAssetSpec(assetGroup, revisionID);\n            if (simd !== undefined && !['detect', 'force', 'disable'].includes(simd)) {\n                throw new Error(`Unrecognized SIMD option ${simd}`);\n            }\n            if (executionPreference !== undefined && !['auto', 'inline', 'worker', 'worker-sab', 'worker-postMessage'].includes(executionPreference)) {\n                throw new Error(`Unrecognized execution preference ${executionPreference}`);\n            }\n            if (usagePreference !== undefined && !['quality', 'interactivity'].includes(usagePreference)) {\n                throw new Error(`Unrecognized usage preference ${usagePreference}`);\n            }\n            const executionSpec = {\n                executionPreference: this.mungeExecutionPreference(executionPreference, logger),\n                usagePreference,\n                executionQuantaPreference,\n                variantPreference,\n                namePreference: name,\n                simdPreference: simd,\n                estimatorBudget,\n            };\n            const assetConfig = revisionID ? { revisionID } : { assetGroup };\n            const updatedFetchBehavior = fetch_js_1.addQueryParams(fetchBehavior, assetConfig);\n            const fetchConfig = Object.assign({ paths }, updatedFetchBehavior);\n            const executionDefinition = yield decider_js_1.measureAndDecideExecutionApproach(executionSpec, fetchConfig, logger, thresholds);\n            if (executionDefinition.supported === false) {\n                return { supported: false, reason: executionDefinition.reason };\n            }\n            logger === null || logger === void 0 ? void 0 : logger.info('Decided execution approach', executionDefinition);\n            const { useSIMD, processor, variant, executionQuanta } = executionDefinition;\n            const model = {\n                category: category || 'voicefocus',\n                name: name || 'default',\n                variant,\n                simd: useSIMD,\n            };\n            if (preResolve) {\n                const startingURL = urlForModel(model, paths);\n                model.url = yield fetch_js_1.resolveURL(startingURL, updatedFetchBehavior);\n            }\n            return {\n                fetchConfig,\n                model,\n                processor,\n                executionQuanta,\n                supported: true,\n            };\n        });\n    }\n    static init(configuration, { delegate, preload = true, logger, }) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (configuration.supported === false) {\n                throw new Error('Voice Focus not supported. Reason: ' + configuration.reason);\n            }\n            const { model, processor, fetchConfig, executionQuanta, } = configuration;\n            const { simd, name } = model;\n            const { paths } = fetchConfig;\n            if (processor !== 'voicefocus-inline-processor' &&\n                processor !== 'voicefocus-worker-postMessage-processor' &&\n                processor !== 'voicefocus-worker-sab-processor') {\n                throw new Error(`Unknown processor ${processor}`);\n            }\n            const modelURL = model.url || urlForModel(model, paths);\n            logger === null || logger === void 0 ? void 0 : logger.debug(`Using model URL ${modelURL}.`);\n            const audioBufferURL = `${paths.wasm}audio_buffer-v1${simd ? '_simd' : ''}.wasm`;\n            const resamplerURL = `${paths.wasm}resampler-v1${simd ? '_simd' : ''}.wasm`;\n            const workerURL = `${paths.workers}worker-v1.js`;\n            const { file, node } = PROCESSORS[processor];\n            const processorURL = `${paths.processors}${file}`;\n            const worker = yield loader_js_1.loadWorker(workerURL, 'VoiceFocusWorker', fetchConfig, logger);\n            if (preload) {\n                logger === null || logger === void 0 ? void 0 : logger.debug('Preloading', modelURL);\n                let message = support_js_1.supportsWASMPostMessage(globalThis) ? 'get-module' : 'get-module-buffer';\n                worker.postMessage({\n                    message,\n                    preload: true,\n                    key: 'model',\n                    fetchBehavior: fetchConfig,\n                    path: modelURL,\n                });\n            }\n            const numberOfInputs = (name === 'ns_es') ? 2 : 1;\n            const nodeOptions = {\n                processor,\n                worker,\n                audioBufferURL,\n                resamplerURL,\n                fetchBehavior: fetchConfig,\n                modelURL,\n                delegate,\n                logger,\n                numberOfInputs,\n            };\n            const factory = new VoiceFocus(worker, processorURL, node, nodeOptions, executionQuanta);\n            return Promise.resolve(factory);\n        });\n    }\n    createNode(context, options) {\n        var _a;\n        const { voiceFocusSampleRate = (context.sampleRate === 16000 ? 16000 : 48000), enabled = true, agc = DEFAULT_AGC_SETTING, } = options || {};\n        const supportFarendStream = options === null || options === void 0 ? void 0 : options.es;\n        const processorOptions = {\n            voiceFocusSampleRate,\n            enabled,\n            sendBufferCount: 10,\n            prefill: 6,\n            agc,\n            executionQuanta: this.executionQuanta,\n            supportFarendStream,\n        };\n        const url = fetch_js_1.withQueryString(this.processorURL, (_a = this.nodeOptions) === null || _a === void 0 ? void 0 : _a.fetchBehavior);\n        return context.audioWorklet\n            .addModule(url)\n            .then(() => new (this.nodeConstructor)(context, Object.assign(Object.assign({}, this.nodeOptions), { processorOptions })));\n    }\n    applyToStream(stream, context, options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const source = context.createMediaStreamSource(stream);\n            const node = yield this.applyToSourceNode(source, context, options);\n            const destination = context.createMediaStreamDestination();\n            node.connect(destination);\n            return {\n                node,\n                source,\n                destination,\n                stream: destination.stream,\n            };\n        });\n    }\n    applyToSourceNode(source, context, options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const node = yield this.createNode(context, options);\n            source.connect(node);\n            return node;\n        });\n    }\n}\nexports.VoiceFocus = VoiceFocus;\nconst createAudioContext = (contextHint = DEFAULT_CONTEXT_HINT) => {\n    return new (window.AudioContext || window.webkitAudioContext)(contextHint);\n};\nexports.createAudioContext = createAudioContext;\nconst getAudioInput = (context, inputOptions, voiceFocusOptions) => __awaiter(void 0, void 0, void 0, function* () {\n    var _a, _b;\n    const { constraints, spec, delegate, preload = true, options } = inputOptions;\n    const { logger } = voiceFocusOptions;\n    const config = yield VoiceFocus.configure(spec, voiceFocusOptions);\n    if (!config.supported) {\n        (_a = voiceFocusOptions.logger) === null || _a === void 0 ? void 0 : _a.warn('Voice Focus not supported; returning standard stream.');\n        return window.navigator.mediaDevices.getUserMedia(constraints);\n    }\n    const factory = yield VoiceFocus.init(config, { delegate, preload, logger });\n    const agc = ((_b = inputOptions.options) === null || _b === void 0 ? void 0 : _b.agc) || DEFAULT_AGC_SETTING;\n    const input = yield window.navigator.mediaDevices.getUserMedia(mungeConstraints(constraints, agc));\n    return factory.applyToStream(input, context, options).then(result => result.stream);\n});\nexports.getAudioInput = getAudioInput;\n"],"mappings":"AAAA;;AACA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA4B,UAAUC,OAAV,EAAmBC,UAAnB,EAA+BC,CAA/B,EAAkCC,SAAlC,EAA6C;EACrF,SAASC,KAAT,CAAeC,KAAf,EAAsB;IAAE,OAAOA,KAAK,YAAYH,CAAjB,GAAqBG,KAArB,GAA6B,IAAIH,CAAJ,CAAM,UAAUI,OAAV,EAAmB;MAAEA,OAAO,CAACD,KAAD,CAAP;IAAiB,CAA5C,CAApC;EAAoF;;EAC5G,OAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAT,CAAN,EAAyB,UAAUD,OAAV,EAAmBE,MAAnB,EAA2B;IACvD,SAASC,SAAT,CAAmBJ,KAAnB,EAA0B;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAACQ,IAAV,CAAeN,KAAf,CAAD,CAAJ;MAA8B,CAApC,CAAqC,OAAOO,CAAP,EAAU;QAAEJ,MAAM,CAACI,CAAD,CAAN;MAAY;IAAE;;IAC3F,SAASC,QAAT,CAAkBR,KAAlB,EAAyB;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAAC,OAAD,CAAT,CAAmBE,KAAnB,CAAD,CAAJ;MAAkC,CAAxC,CAAyC,OAAOO,CAAP,EAAU;QAAEJ,MAAM,CAACI,CAAD,CAAN;MAAY;IAAE;;IAC9F,SAASF,IAAT,CAAcI,MAAd,EAAsB;MAAEA,MAAM,CAACC,IAAP,GAAcT,OAAO,CAACQ,MAAM,CAACT,KAAR,CAArB,GAAsCD,KAAK,CAACU,MAAM,CAACT,KAAR,CAAL,CAAoBW,IAApB,CAAyBP,SAAzB,EAAoCI,QAApC,CAAtC;IAAsF;;IAC9GH,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACc,KAAV,CAAgBjB,OAAhB,EAAyBC,UAAU,IAAI,EAAvC,CAAb,EAAyDU,IAAzD,EAAD,CAAJ;EACH,CALM,CAAP;AAMH,CARD;;AASAO,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEf,KAAK,EAAE;AAAT,CAA7C;AACAe,OAAO,CAACC,aAAR,GAAwBD,OAAO,CAACE,kBAAR,GAA6BF,OAAO,CAACG,UAAR,GAAqB,KAAK,CAA/E;;AACA,MAAMC,YAAY,GAAGC,OAAO,CAAC,cAAD,CAA5B;;AACA,MAAMC,UAAU,GAAGD,OAAO,CAAC,YAAD,CAA1B;;AACA,MAAME,WAAW,GAAGF,OAAO,CAAC,aAAD,CAA3B;;AACA,MAAMG,YAAY,GAAGH,OAAO,CAAC,cAAD,CAA5B;;AACA,MAAMI,wBAAwB,GAAGJ,OAAO,CAAC,0BAAD,CAAxC;;AACA,MAAMK,4BAA4B,GAAGL,OAAO,CAAC,8BAAD,CAA5C;;AACA,MAAMM,oCAAoC,GAAGN,OAAO,CAAC,sCAAD,CAApD;;AACA,MAAMO,4BAA4B,GAAG;EACjCC,gBAAgB,EAAE,KADe;EAEjCC,aAAa,EAAE;AAFkB,CAArC;AAIA,MAAMC,mBAAmB,GAAGH,4BAA5B;AACA,MAAMI,mBAAmB,GAAG,WAA5B;AACA,MAAMC,WAAW,GAAG,qCAApB;AACA,MAAMC,aAAa,GAAG;EAClBC,UAAU,EAAG,GAAEF,WAAY,aADT;EAElBG,OAAO,EAAG,GAAEH,WAAY,UAFN;EAGlBI,IAAI,EAAG,GAAEJ,WAAY,OAHH;EAIlBK,MAAM,EAAG,GAAEL,WAAY;AAJL,CAAtB;AAMA,MAAMM,oBAAoB,GAAG;EACzBC,WAAW,EAAE;AADY,CAA7B;AAGA,MAAMC,sBAAsB,GAAG;EAC3BC,YAAY,EAAE,CADa;EAE3BC,gBAAgB,EAAE,IAFS;EAG3BC,oBAAoB,EAAE,IAHK;EAI3BC,gBAAgB,EAAE,KAJS;EAK3BC,oBAAoB,EAAE,KALK;EAM3BC,kBAAkB,EAAE,KANO;EAO3BC,wBAAwB,EAAE;AAPC,CAA/B;AASA,MAAMC,0CAA0C,GAAGnC,MAAM,CAACoC,MAAP,CAAcpC,MAAM,CAACoC,MAAP,CAAc,EAAd,EAAkBT,sBAAlB,CAAd,EAAyD;EAAEU,eAAe,EAAE,IAAnB;EAAyBC,mBAAmB,EAAE,IAA9C;EAAoDC,oBAAoB,EAAE;AAA1E,CAAzD,CAAnD;AACA,MAAMC,6CAA6C,GAAGxC,MAAM,CAACoC,MAAP,CAAcpC,MAAM,CAACoC,MAAP,CAAc,EAAd,EAAkBT,sBAAlB,CAAd,EAAyD;EAAEU,eAAe,EAAE,KAAnB;EAA0BC,mBAAmB,EAAE,KAA/C;EAAsDC,oBAAoB,EAAE;AAA5E,CAAzD,CAAtD;AACA,MAAME,UAAU,GAAG;EACf,mCAAmC;IAC/BC,IAAI,EAAE,oCADyB;IAE/BC,IAAI,EAAE/B,4BAA4B,CAACgC;EAFJ,CADpB;EAKf,2CAA2C;IACvCF,IAAI,EAAE,4CADiC;IAEvCC,IAAI,EAAE9B,oCAAoC,CAAC+B;EAFJ,CAL5B;EASf,+BAA+B;IAC3BF,IAAI,EAAE,gCADqB;IAE3BC,IAAI,EAAEhC,wBAAwB,CAACiC;EAFJ;AAThB,CAAnB;;AAcA,MAAMC,iBAAiB,GAAG,CAACC,UAAD,EAAaC,UAAb,KAA4B;EAClD,IAAID,UAAU,KAAKE,SAAf,IAA4B,CAACxC,UAAU,CAACyC,iBAAX,CAA6BH,UAA7B,CAAjC,EAA2E;IACvE,MAAM,IAAII,KAAJ,CAAW,uBAAsBJ,UAAW,EAA5C,CAAN;EACH;;EACD,IAAIC,UAAU,KAAKC,SAAf,IAA4B,CAACxC,UAAU,CAAC2C,iBAAX,CAA6BJ,UAA7B,CAAjC,EAA2E;IACvE,MAAM,IAAIG,KAAJ,CAAW,uBAAsBH,UAAW,EAA5C,CAAN;EACH;AACJ,CAPD;;AAQA,MAAMK,gBAAgB,GAAG,CAACC,WAAD,EAAcC,GAAd,KAAsB;EAC3C,IAAIC,kBAAJ;;EACA,IAAID,GAAG,CAACtC,aAAR,EAAuB;IACnBuC,kBAAkB,GAAGpB,0CAArB;EACH,CAFD,MAGK;IACDoB,kBAAkB,GAAGf,6CAArB;EACH;;EACD,IAAI,CAACa,WAAL,EAAkB;IACd,OAAO;MAAEG,KAAK,EAAED;IAAT,CAAP;EACH;;EACD,IAAI,CAACF,WAAW,CAACG,KAAjB,EAAwB;IACpB,OAAOH,WAAP;EACH;;EACD,IAAIA,WAAW,CAACI,KAAhB,EAAuB;IACnB,MAAM,IAAIP,KAAJ,CAAU,2DAAV,CAAN;EACH;;EACD,OAAOlD,MAAM,CAACoC,MAAP,CAAcpC,MAAM,CAACoC,MAAP,CAAc,EAAd,EAAkBiB,WAAlB,CAAd,EAA8C;IAAEG,KAAK,EAAEH,WAAW,CAACG,KAAZ,KAAsB,IAAtB,GAA6BD,kBAA7B,GAAkDvD,MAAM,CAACoC,MAAP,CAAcpC,MAAM,CAACoC,MAAP,CAAc,EAAd,EAAkBiB,WAAW,CAACG,KAA9B,CAAd,EAAoDD,kBAApD;EAA3D,CAA9C,CAAP;AACH,CAlBD;;AAmBA,MAAMG,WAAW,GAAG,CAACC,KAAD,EAAQC,KAAR,KAAkB;EAClC,OAAQ,GAAEA,KAAK,CAACpC,MAAO,GAAElB,YAAY,CAACuD,WAAb,CAAyBF,KAAzB,CAAgC,OAAzD;AACH,CAFD;;AAGA,MAAMtD,UAAN,CAAiB;EACbyD,WAAW,CAACC,MAAD,EAASC,YAAT,EAAuBC,eAAvB,EAAwCC,WAAxC,EAAqDC,eAArD,EAAsE;IAC7E,KAAKH,YAAL,GAAoBA,YAApB;IACA,KAAKC,eAAL,GAAuBA,eAAvB;IACA,KAAKC,WAAL,GAAmBA,WAAnB;IACA,KAAKC,eAAL,GAAuBA,eAAvB;IACA,KAAKC,QAAL,GAAgB;MACZL,MADY;MAEZG;IAFY,CAAhB;EAIH;;EACiB,OAAXG,WAAW,CAACC,IAAD,EAAOC,OAAP,EAAgB;IAC9B,MAAM;MAAEC,aAAF;MAAiBC;IAAjB,IAA4BF,OAAO,IAAI,EAA7C;;IACA,IAAI,OAAOG,UAAP,KAAsB,WAA1B,EAAuC;MACnCD,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACE,KAAP,CAAa,mCAAb,CAAhD;MACA,OAAOtF,OAAO,CAACD,OAAR,CAAgB,KAAhB,CAAP;IACH;;IACD,IAAI,CAACsB,YAAY,CAACkE,oBAAb,CAAkCF,UAAlC,EAA8CD,MAA9C,CAAL,EAA4D;MACxDA,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACE,KAAP,CAAa,yCAAb,CAAhD;MACA,OAAOtF,OAAO,CAACD,OAAR,CAAgB,KAAhB,CAAP;IACH;;IACD,IAAI,CAACsB,YAAY,CAACmE,YAAb,CAA0BH,UAA1B,EAAsCD,MAAtC,CAAL,EAAoD;MAChDA,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACE,KAAP,CAAa,gCAAb,CAAhD;MACA,OAAOtF,OAAO,CAACD,OAAR,CAAgB,KAAhB,CAAP;IACH;;IACD,IAAI,CAACsB,YAAY,CAACoE,qBAAb,CAAmCJ,UAAnC,EAA+CD,MAA/C,CAAL,EAA6D;MACzDA,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACE,KAAP,CAAa,sDAAb,CAAhD;IACH;;IACD,MAAM;MAAE7B,UAAU,GAAG5B,mBAAf;MAAoC6B,UAApC;MAAgDa,KAAK,GAAGxC;IAAxD,IAA2EkD,IAAI,IAAI,EAAzF;IACAzB,iBAAiB,CAACC,UAAD,EAAaC,UAAb,CAAjB;IACA,MAAMgC,WAAW,GAAGhC,UAAU,GAAG;MAAEA;IAAF,CAAH,GAAoB;MAAED;IAAF,CAAlD;IACA,MAAMkC,oBAAoB,GAAGxE,UAAU,CAACyE,cAAX,CAA0BT,aAA1B,EAAyCO,WAAzC,CAA7B;IACA,MAAMG,WAAW,GAAGlF,MAAM,CAACoC,MAAP,CAAcpC,MAAM,CAACoC,MAAP,CAAc,EAAd,EAAkB4C,oBAAlB,CAAd,EAAuD;MAAEpB;IAAF,CAAvD,CAApB;IACA,OAAOlD,YAAY,CAACyE,wBAAb,CAAsCT,UAAtC,EAAkDQ,WAAlD,EAA+DT,MAA/D,CAAP;EACH;;EAC8B,OAAxBW,wBAAwB,CAACC,UAAD,EAAaZ,MAAb,EAAqB;IAChD,MAAMa,MAAM,GAAID,UAAU,KAAKrC,SAAf,IAA4BqC,UAAU,KAAK,MAA3D;;IACA,IAAI3E,YAAY,CAAC6E,QAAb,CAAsBb,UAAtB,CAAJ,EAAuC;MACnC,IAAIY,MAAM,IAAID,UAAU,KAAK,QAA7B,EAAuC;QACnC,OAAO,QAAP;MACH;;MACD,IAAI,CAACC,MAAL,EAAa;QACT,MAAM,IAAIpC,KAAJ,CAAW,oCAAmCmC,UAAW,EAAzD,CAAN;MACH;IACJ;;IACD,IAAIA,UAAU,KAAK,YAAf,IAA+B,CAAC3E,YAAY,CAAC8E,yBAAb,CAAuCd,UAAvC,EAAmDA,UAAnD,EAA+DD,MAA/D,CAApC,EAA4G;MACxG,MAAM,IAAIvB,KAAJ,CAAW,oCAAmCmC,UAAW,EAAzD,CAAN;IACH;;IACD,OAAOA,UAAU,IAAI,MAArB;EACH;;EACe,OAATI,SAAS,CAACnB,IAAD,EAAOC,OAAP,EAAgB;IAC5B,OAAO1F,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;MAChD,MAAM;QAAE2F,aAAF;QAAiBkB,UAAjB;QAA6BjB;MAA7B,IAAyCF,OAAO,IAAI,EAA1D;MACA,MAAM;QAAEoB,QAAQ,GAAG,YAAb;QAA2BC,IAAI,GAAG,SAAlC;QAA6CC,OAAO,EAAEC,iBAAiB,GAAG,MAA1E;QAAkFhD,UAAU,GAAG5B,mBAA/F;QAAoH6B,UAApH;QAAgIgD,IAAI,GAAG,QAAvI;QAAiJC,mBAAmB,GAAG,MAAvK;QAA+KC,yBAA/K;QAA0MC,eAAe,GAAG,eAA5N;QAA6OC,eAAe,GAAG,GAA/P;QAAoQvC,KAAK,GAAGxC,aAA5Q;QAA2RgF;MAA3R,IAA2S9B,IAAI,IAAI,EAAzT;MACAG,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACE,KAAP,CAAa,mCAAb,EAAkDL,IAAlD,CAAhD;;MACA,IAAIqB,QAAQ,KAAK3C,SAAb,IAA0B2C,QAAQ,KAAK,YAA3C,EAAyD;QACrD,MAAM,IAAIzC,KAAJ,CAAW,yBAAwByC,QAAS,EAA5C,CAAN;MACH;;MACD,IAAIC,IAAI,KAAK5C,SAAT,IAAsB4C,IAAI,KAAK,SAA/B,IAA4CA,IAAI,KAAK,OAAzD,EAAkE;QAC9D,MAAM,IAAI1C,KAAJ,CAAW,6BAA4B0C,IAAK,EAA5C,CAAN;MACH;;MACD,IAAIE,iBAAiB,KAAK9C,SAAtB,IAAmC,CAAC,CAAC,MAAD,EAAS,MAAT,EAAiB,KAAjB,EAAwB,KAAxB,EAA+B,KAA/B,EAAsCqD,QAAtC,CAA+CP,iBAA/C,CAAxC,EAA2G;QACvG,MAAM,IAAI5C,KAAJ,CAAW,gCAA+B4C,iBAAkB,EAA5D,CAAN;MACH;;MACD,IAAIG,yBAAyB,KAAKjD,SAA9B,IAA2C,CAAC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAUqD,QAAV,CAAmBJ,yBAAnB,CAAhD,EAA+F;QAC3F,MAAM,IAAI/C,KAAJ,CAAW,4CAA2C+C,yBAA0B,EAAhF,CAAN;MACH;;MACDpD,iBAAiB,CAACC,UAAD,EAAaC,UAAb,CAAjB;;MACA,IAAIgD,IAAI,KAAK/C,SAAT,IAAsB,CAAC,CAAC,QAAD,EAAW,OAAX,EAAoB,SAApB,EAA+BqD,QAA/B,CAAwCN,IAAxC,CAA3B,EAA0E;QACtE,MAAM,IAAI7C,KAAJ,CAAW,4BAA2B6C,IAAK,EAA3C,CAAN;MACH;;MACD,IAAIC,mBAAmB,KAAKhD,SAAxB,IAAqC,CAAC,CAAC,MAAD,EAAS,QAAT,EAAmB,QAAnB,EAA6B,YAA7B,EAA2C,oBAA3C,EAAiEqD,QAAjE,CAA0EL,mBAA1E,CAA1C,EAA0I;QACtI,MAAM,IAAI9C,KAAJ,CAAW,qCAAoC8C,mBAAoB,EAAnE,CAAN;MACH;;MACD,IAAIE,eAAe,KAAKlD,SAApB,IAAiC,CAAC,CAAC,SAAD,EAAY,eAAZ,EAA6BqD,QAA7B,CAAsCH,eAAtC,CAAtC,EAA8F;QAC1F,MAAM,IAAIhD,KAAJ,CAAW,iCAAgCgD,eAAgB,EAA3D,CAAN;MACH;;MACD,MAAMI,aAAa,GAAG;QAClBN,mBAAmB,EAAE,KAAKZ,wBAAL,CAA8BY,mBAA9B,EAAmDvB,MAAnD,CADH;QAElByB,eAFkB;QAGlBD,yBAHkB;QAIlBH,iBAJkB;QAKlBS,cAAc,EAAEX,IALE;QAMlBY,cAAc,EAAET,IANE;QAOlBI;MAPkB,CAAtB;MASA,MAAMpB,WAAW,GAAGhC,UAAU,GAAG;QAAEA;MAAF,CAAH,GAAoB;QAAED;MAAF,CAAlD;MACA,MAAMkC,oBAAoB,GAAGxE,UAAU,CAACyE,cAAX,CAA0BT,aAA1B,EAAyCO,WAAzC,CAA7B;MACA,MAAMG,WAAW,GAAGlF,MAAM,CAACoC,MAAP,CAAc;QAAEwB;MAAF,CAAd,EAAyBoB,oBAAzB,CAApB;MACA,MAAMyB,mBAAmB,GAAG,MAAMnG,YAAY,CAACoG,iCAAb,CAA+CJ,aAA/C,EAA8DpB,WAA9D,EAA2ET,MAA3E,EAAmF2B,UAAnF,CAAlC;;MACA,IAAIK,mBAAmB,CAACE,SAApB,KAAkC,KAAtC,EAA6C;QACzC,OAAO;UAAEA,SAAS,EAAE,KAAb;UAAoBC,MAAM,EAAEH,mBAAmB,CAACG;QAAhD,CAAP;MACH;;MACDnC,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACoC,IAAP,CAAY,4BAAZ,EAA0CJ,mBAA1C,CAAhD;MACA,MAAM;QAAEK,OAAF;QAAWC,SAAX;QAAsBlB,OAAtB;QAA+B1B;MAA/B,IAAmDsC,mBAAzD;MACA,MAAM9C,KAAK,GAAG;QACVgC,QAAQ,EAAEA,QAAQ,IAAI,YADZ;QAEVC,IAAI,EAAEA,IAAI,IAAI,SAFJ;QAGVC,OAHU;QAIVE,IAAI,EAAEe;MAJI,CAAd;;MAMA,IAAIpB,UAAJ,EAAgB;QACZ,MAAMsB,WAAW,GAAGtD,WAAW,CAACC,KAAD,EAAQC,KAAR,CAA/B;QACAD,KAAK,CAACsD,GAAN,GAAY,MAAMzG,UAAU,CAAC0G,UAAX,CAAsBF,WAAtB,EAAmChC,oBAAnC,CAAlB;MACH;;MACD,OAAO;QACHE,WADG;QAEHvB,KAFG;QAGHoD,SAHG;QAIH5C,eAJG;QAKHwC,SAAS,EAAE;MALR,CAAP;IAOH,CA7De,CAAhB;EA8DH;;EACU,OAAJQ,IAAI,CAACC,aAAD,QAAuD;IAAA,IAAvC;MAAEC,QAAF;MAAYC,OAAO,GAAG,IAAtB;MAA4B7C;IAA5B,CAAuC;IAC9D,OAAO5F,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;MAChD,IAAIuI,aAAa,CAACT,SAAd,KAA4B,KAAhC,EAAuC;QACnC,MAAM,IAAIzD,KAAJ,CAAU,wCAAwCkE,aAAa,CAACR,MAAhE,CAAN;MACH;;MACD,MAAM;QAAEjD,KAAF;QAASoD,SAAT;QAAoB7B,WAApB;QAAiCf;MAAjC,IAAsDiD,aAA5D;MACA,MAAM;QAAErB,IAAF;QAAQH;MAAR,IAAiBjC,KAAvB;MACA,MAAM;QAAEC;MAAF,IAAYsB,WAAlB;;MACA,IAAI6B,SAAS,KAAK,6BAAd,IACAA,SAAS,KAAK,yCADd,IAEAA,SAAS,KAAK,iCAFlB,EAEqD;QACjD,MAAM,IAAI7D,KAAJ,CAAW,qBAAoB6D,SAAU,EAAzC,CAAN;MACH;;MACD,MAAMQ,QAAQ,GAAG5D,KAAK,CAACsD,GAAN,IAAavD,WAAW,CAACC,KAAD,EAAQC,KAAR,CAAzC;MACAa,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACE,KAAP,CAAc,mBAAkB4C,QAAS,GAAzC,CAAhD;MACA,MAAMC,cAAc,GAAI,GAAE5D,KAAK,CAACrC,IAAK,kBAAiBwE,IAAI,GAAG,OAAH,GAAa,EAAG,OAA1E;MACA,MAAM0B,YAAY,GAAI,GAAE7D,KAAK,CAACrC,IAAK,eAAcwE,IAAI,GAAG,OAAH,GAAa,EAAG,OAArE;MACA,MAAM2B,SAAS,GAAI,GAAE9D,KAAK,CAACtC,OAAQ,cAAnC;MACA,MAAM;QAAEoB,IAAF;QAAQC;MAAR,IAAiBF,UAAU,CAACsE,SAAD,CAAjC;MACA,MAAM/C,YAAY,GAAI,GAAEJ,KAAK,CAACvC,UAAW,GAAEqB,IAAK,EAAhD;MACA,MAAMqB,MAAM,GAAG,MAAMtD,WAAW,CAACkH,UAAZ,CAAuBD,SAAvB,EAAkC,kBAAlC,EAAsDxC,WAAtD,EAAmET,MAAnE,CAArB;;MACA,IAAI6C,OAAJ,EAAa;QACT7C,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAACE,KAAP,CAAa,YAAb,EAA2B4C,QAA3B,CAAhD;QACA,IAAIK,OAAO,GAAGlH,YAAY,CAACmH,uBAAb,CAAqCnD,UAArC,IAAmD,YAAnD,GAAkE,mBAAhF;QACAX,MAAM,CAAC+D,WAAP,CAAmB;UACfF,OADe;UAEfN,OAAO,EAAE,IAFM;UAGfS,GAAG,EAAE,OAHU;UAIfvD,aAAa,EAAEU,WAJA;UAKf8C,IAAI,EAAET;QALS,CAAnB;MAOH;;MACD,MAAMU,cAAc,GAAIrC,IAAI,KAAK,OAAV,GAAqB,CAArB,GAAyB,CAAhD;MACA,MAAM1B,WAAW,GAAG;QAChB6C,SADgB;QAEhBhD,MAFgB;QAGhByD,cAHgB;QAIhBC,YAJgB;QAKhBjD,aAAa,EAAEU,WALC;QAMhBqC,QANgB;QAOhBF,QAPgB;QAQhB5C,MARgB;QAShBwD;MATgB,CAApB;MAWA,MAAMC,OAAO,GAAG,IAAI7H,UAAJ,CAAe0D,MAAf,EAAuBC,YAAvB,EAAqCrB,IAArC,EAA2CuB,WAA3C,EAAwDC,eAAxD,CAAhB;MACA,OAAO9E,OAAO,CAACD,OAAR,CAAgB8I,OAAhB,CAAP;IACH,CA7Ce,CAAhB;EA8CH;;EACDC,UAAU,CAACC,OAAD,EAAU7D,OAAV,EAAmB;IACzB,IAAI8D,EAAJ;;IACA,MAAM;MAAEC,oBAAoB,GAAIF,OAAO,CAACG,UAAR,KAAuB,KAAvB,GAA+B,KAA/B,GAAuC,KAAjE;MAAyEC,OAAO,GAAG,IAAnF;MAAyFlF,GAAG,GAAGrC;IAA/F,IAAwHsD,OAAO,IAAI,EAAzI;IACA,MAAMkE,mBAAmB,GAAGlE,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyC,KAAK,CAA9C,GAAkDA,OAAO,CAACmE,EAAtF;IACA,MAAMC,gBAAgB,GAAG;MACrBL,oBADqB;MAErBE,OAFqB;MAGrBI,eAAe,EAAE,EAHI;MAIrBC,OAAO,EAAE,CAJY;MAKrBvF,GALqB;MAMrBa,eAAe,EAAE,KAAKA,eAND;MAOrBsE;IAPqB,CAAzB;IASA,MAAMxB,GAAG,GAAGzG,UAAU,CAACsI,eAAX,CAA2B,KAAK9E,YAAhC,EAA8C,CAACqE,EAAE,GAAG,KAAKnE,WAAX,MAA4B,IAA5B,IAAoCmE,EAAE,KAAK,KAAK,CAAhD,GAAoD,KAAK,CAAzD,GAA6DA,EAAE,CAAC7D,aAA9G,CAAZ;IACA,OAAO4D,OAAO,CAACW,YAAR,CACFC,SADE,CACQ/B,GADR,EAEFnH,IAFE,CAEG,MAAM,IAAK,KAAKmE,eAAV,CAA2BmE,OAA3B,EAAoCpI,MAAM,CAACoC,MAAP,CAAcpC,MAAM,CAACoC,MAAP,CAAc,EAAd,EAAkB,KAAK8B,WAAvB,CAAd,EAAmD;MAAEyE;IAAF,CAAnD,CAApC,CAFT,CAAP;EAGH;;EACDM,aAAa,CAACC,MAAD,EAASd,OAAT,EAAkB7D,OAAlB,EAA2B;IACpC,OAAO1F,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;MAChD,MAAMsK,MAAM,GAAGf,OAAO,CAACgB,uBAAR,CAAgCF,MAAhC,CAAf;MACA,MAAMvG,IAAI,GAAG,MAAM,KAAK0G,iBAAL,CAAuBF,MAAvB,EAA+Bf,OAA/B,EAAwC7D,OAAxC,CAAnB;MACA,MAAM+E,WAAW,GAAGlB,OAAO,CAACmB,4BAAR,EAApB;MACA5G,IAAI,CAAC6G,OAAL,CAAaF,WAAb;MACA,OAAO;QACH3G,IADG;QAEHwG,MAFG;QAGHG,WAHG;QAIHJ,MAAM,EAAEI,WAAW,CAACJ;MAJjB,CAAP;IAMH,CAXe,CAAhB;EAYH;;EACDG,iBAAiB,CAACF,MAAD,EAASf,OAAT,EAAkB7D,OAAlB,EAA2B;IACxC,OAAO1F,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,aAAa;MAChD,MAAM8D,IAAI,GAAG,MAAM,KAAKwF,UAAL,CAAgBC,OAAhB,EAAyB7D,OAAzB,CAAnB;MACA4E,MAAM,CAACK,OAAP,CAAe7G,IAAf;MACA,OAAOA,IAAP;IACH,CAJe,CAAhB;EAKH;;AAxMY;;AA0MjBzC,OAAO,CAACG,UAAR,GAAqBA,UAArB;;AACA,MAAMD,kBAAkB,GAAG,YAAwC;EAAA,IAAvCqJ,WAAuC,uEAAzBhI,oBAAyB;EAC/D,OAAO,KAAKiI,MAAM,CAACC,YAAP,IAAuBD,MAAM,CAACE,kBAAnC,EAAuDH,WAAvD,CAAP;AACH,CAFD;;AAGAvJ,OAAO,CAACE,kBAAR,GAA6BA,kBAA7B;;AACA,MAAMD,aAAa,GAAG,CAACiI,OAAD,EAAUyB,YAAV,EAAwBC,iBAAxB,KAA8CjL,SAAS,CAAC,KAAK,CAAN,EAAS,KAAK,CAAd,EAAiB,KAAK,CAAtB,EAAyB,aAAa;EAC/G,IAAIwJ,EAAJ,EAAQ0B,EAAR;;EACA,MAAM;IAAE1G,WAAF;IAAeiB,IAAf;IAAqB+C,QAArB;IAA+BC,OAAO,GAAG,IAAzC;IAA+C/C;EAA/C,IAA2DsF,YAAjE;EACA,MAAM;IAAEpF;EAAF,IAAaqF,iBAAnB;EACA,MAAME,MAAM,GAAG,MAAM3J,UAAU,CAACoF,SAAX,CAAqBnB,IAArB,EAA2BwF,iBAA3B,CAArB;;EACA,IAAI,CAACE,MAAM,CAACrD,SAAZ,EAAuB;IACnB,CAAC0B,EAAE,GAAGyB,iBAAiB,CAACrF,MAAxB,MAAoC,IAApC,IAA4C4D,EAAE,KAAK,KAAK,CAAxD,GAA4D,KAAK,CAAjE,GAAqEA,EAAE,CAAC4B,IAAH,CAAQ,uDAAR,CAArE;IACA,OAAOP,MAAM,CAACQ,SAAP,CAAiBC,YAAjB,CAA8BC,YAA9B,CAA2C/G,WAA3C,CAAP;EACH;;EACD,MAAM6E,OAAO,GAAG,MAAM7H,UAAU,CAAC8G,IAAX,CAAgB6C,MAAhB,EAAwB;IAAE3C,QAAF;IAAYC,OAAZ;IAAqB7C;EAArB,CAAxB,CAAtB;EACA,MAAMnB,GAAG,GAAG,CAAC,CAACyG,EAAE,GAAGF,YAAY,CAACtF,OAAnB,MAAgC,IAAhC,IAAwCwF,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAACzG,GAArE,KAA6ErC,mBAAzF;EACA,MAAMoJ,KAAK,GAAG,MAAMX,MAAM,CAACQ,SAAP,CAAiBC,YAAjB,CAA8BC,YAA9B,CAA2ChH,gBAAgB,CAACC,WAAD,EAAcC,GAAd,CAA3D,CAApB;EACA,OAAO4E,OAAO,CAACe,aAAR,CAAsBoB,KAAtB,EAA6BjC,OAA7B,EAAsC7D,OAAtC,EAA+CzE,IAA/C,CAAoDF,MAAM,IAAIA,MAAM,CAACsJ,MAArE,CAAP;AACH,CAb4E,CAA7E;;AAcAhJ,OAAO,CAACC,aAAR,GAAwBA,aAAxB"},"metadata":{},"sourceType":"script"}