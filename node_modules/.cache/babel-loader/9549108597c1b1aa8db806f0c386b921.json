{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decideModel = exports.measureAndDecideExecutionApproach = void 0;\n\nconst loader_js_1 = require(\"./loader.js\");\n\nconst support_js_1 = require(\"./support.js\");\n\nconst DEFAULT_EXECUTION_QUANTA = 3;\nconst SIMD_SCORE_FIXED_POINT = 2.50;\nconst WASM_SCORE_FIXED_POINT = 2.63;\nconst SINGLE_INLINE_SCORE_MULTIPLIER = 0.6;\nconst QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER = 0.65;\nconst INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER = 0.5;\nconst WORKER_SCORE_MULTIPLIER = 0.7;\nconst PERFORMANCE_THRESHOLDS = {\n  wasm: {\n    noSupport: 0.07,\n    inline: {\n      c100: 1,\n      c50: 0.36,\n      c20: 0.16,\n      c10: 0.07\n    },\n    worker: {\n      c100: 0.5,\n      c50: 0.18,\n      c20: 0.08,\n      c10: 0.06\n    }\n  },\n  simd: {\n    noSupport: 0.10,\n    inline: {\n      c100: 1,\n      c50: 0.43,\n      c20: 0.3,\n      c10: 0.2\n    },\n    worker: {\n      c100: 0.5,\n      c50: 0.21,\n      c20: 0.15,\n      c10: 0.10\n    }\n  }\n};\n\nclass Estimator {\n  constructor(fetchConfig, logger) {\n    this.fetchConfig = fetchConfig;\n    this.logger = logger;\n    const workerURL = `${fetchConfig.paths.workers}estimator-v1.js`;\n    this.fetchBehavior = {\n      headers: fetchConfig.headers,\n      escapedQueryString: fetchConfig.escapedQueryString\n    };\n    this.worker = loader_js_1.loadWorker(workerURL, 'VoiceFocusEstimator', this.fetchBehavior, logger);\n  }\n\n  roundtrip(toSend, receive, expectedKey) {\n    return new Promise((resolve, reject) => {\n      this.worker.then(worker => {\n        let listener;\n\n        listener = event => {\n          const {\n            message,\n            key\n          } = event.data;\n\n          if (message === receive && key === expectedKey) {\n            worker.removeEventListener('message', listener);\n            resolve(event.data);\n          }\n        };\n\n        worker.addEventListener('message', listener);\n        worker.postMessage(toSend);\n      }).catch(e => {\n        var _a;\n\n        (_a = this.logger) === null || _a === void 0 ? void 0 : _a.error('Failed to load worker.', e);\n        reject(e);\n      });\n    });\n  }\n\n  supportsSIMD(url) {\n    const key = 'simd';\n    const path = url || `${this.fetchConfig.paths.wasm}simd-v1.wasm`;\n    const toSend = {\n      message: 'supports-simd',\n      fetchBehavior: this.fetchBehavior,\n      path,\n      key\n    };\n    return this.roundtrip(toSend, 'simd-support', key).then(data => data.supports);\n  }\n\n  measure(simd, budget) {\n    const benchWASM = `${this.fetchConfig.paths.wasm}bench-v1.wasm`;\n    const benchSIMD = `${this.fetchConfig.paths.wasm}bench-v1_simd.wasm`;\n    const path = simd ? benchSIMD : benchWASM;\n    const key = `bench:${simd}`;\n    const toSend = {\n      message: 'measure',\n      fetchBehavior: this.fetchBehavior,\n      budget,\n      path,\n      key\n    };\n    return this.roundtrip(toSend, 'measurement', key).then(data => {\n      if (data.measurement) {\n        return data.measurement;\n      }\n\n      throw new Error('Failed to measure.');\n    });\n  }\n\n  stop() {\n    this.worker.then(worker => {\n      var _a;\n\n      (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug('Stopping estimator worker.');\n      worker.terminate();\n    }).catch(e => {});\n  }\n\n}\n\nconst inlineScoreMultiplier = (executionQuanta, usagePreference) => {\n  if (executionQuanta === 1) {\n    return SINGLE_INLINE_SCORE_MULTIPLIER;\n  }\n\n  if (usagePreference === 'quality') {\n    return QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER * executionQuanta;\n  }\n\n  return INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER * executionQuanta;\n};\n\nconst decideExecutionApproach = function (_ref) {\n  let {\n    supportsSIMD,\n    supportsSAB,\n    duration,\n    executionPreference = 'auto',\n    simdPreference,\n    variantPreference = 'auto',\n    namePreference = 'default',\n    usagePreference,\n    executionQuantaPreference = DEFAULT_EXECUTION_QUANTA\n  } = _ref;\n  let allThresholds = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : PERFORMANCE_THRESHOLDS;\n  let logger = arguments.length > 2 ? arguments[2] : undefined;\n  const forceSIMD = simdPreference === 'force';\n  const useSIMD = forceSIMD || simdPreference !== 'disable' && supportsSIMD;\n  const checkScores = duration !== -1;\n  const baseScore = checkScores ? (useSIMD ? SIMD_SCORE_FIXED_POINT : WASM_SCORE_FIXED_POINT) / duration : 0;\n  const thresholds = useSIMD ? allThresholds.simd : allThresholds.wasm;\n  const inlineScore = checkScores ? inlineScoreMultiplier(executionQuantaPreference, usagePreference) * baseScore : 0;\n  const workerScore = checkScores ? WORKER_SCORE_MULTIPLIER * baseScore : 0;\n  const name = namePreference;\n\n  const unsupported = reason => {\n    return {\n      supported: false,\n      reason\n    };\n  };\n\n  if (checkScores) {\n    if (baseScore < thresholds.noSupport) {\n      return unsupported(`Performance score ${baseScore} worse than threshold ${thresholds.noSupport}.`);\n    }\n  } else {\n    if (executionPreference === 'auto' || variantPreference === 'auto') {\n      return unsupported(`Missing explicit execution (${executionPreference}) or variant (${variantPreference}) preference, but no scoring performed.`);\n    }\n  }\n\n  logger === null || logger === void 0 ? void 0 : logger.debug(`Bench duration ${duration} yields inline score ${inlineScore} and worker score ${workerScore}.`);\n\n  const succeed = (processor, executionApproach, variant) => {\n    return {\n      supported: true,\n      useSIMD,\n      processor,\n      executionApproach,\n      variant,\n      executionQuanta: executionApproach === 'inline' ? executionQuantaPreference : undefined,\n      name\n    };\n  };\n\n  const resolveVariant = (score, variant, lookup) => {\n    if (variant !== 'auto') {\n      if (!checkScores || score > lookup[variant]) {\n        return variant;\n      }\n\n      return 'failed';\n    }\n\n    if (score > lookup.c100) {\n      return 'c100';\n    }\n\n    if (score > lookup.c50) {\n      return 'c50';\n    }\n\n    if (score > lookup.c20) {\n      return 'c20';\n    }\n\n    if (score > lookup.c10) {\n      return 'c10';\n    }\n\n    return 'failed';\n  };\n\n  const reducePreference = preference => {\n    switch (preference || 'auto') {\n      case 'auto':\n        {\n          let inlineOption = reducePreference('inline');\n          let workerOption = reducePreference('worker');\n          logger === null || logger === void 0 ? void 0 : logger.debug(`Reducing auto preference: ${JSON.stringify(inlineOption)} vs ${JSON.stringify(workerOption)}`);\n\n          if (inlineOption.supported === false) {\n            return workerOption;\n          }\n\n          if (workerOption.supported === false) {\n            return workerOption;\n          }\n\n          if (inlineOption.variant === workerOption.variant || inlineOption.variant === 'c50') {\n            return inlineOption;\n          }\n\n          return workerOption;\n        }\n\n      case 'worker':\n        {\n          if (support_js_1.supportsSharedArrayBuffer(globalThis, window, logger)) {\n            return reducePreference('worker-sab');\n          }\n\n          return reducePreference('worker-postMessage');\n        }\n\n      case 'inline':\n        {\n          const variant = resolveVariant(inlineScore, variantPreference, thresholds.inline);\n\n          if (variant === 'failed') {\n            return unsupported(`Performance score ${inlineScore} not sufficient for inline use with variant preference ${variantPreference}.`);\n          }\n\n          ;\n          return succeed('voicefocus-inline-processor', 'inline', variant);\n        }\n\n      case 'worker-sab':\n        {\n          if (!supportsSAB) {\n            const reason = 'Requested worker-sab but no SharedArrayBuffer support.';\n            logger === null || logger === void 0 ? void 0 : logger.warn(reason);\n            return {\n              supported: false,\n              reason\n            };\n          }\n\n          const variant = resolveVariant(workerScore, variantPreference, thresholds.worker);\n\n          if (variant === 'failed') {\n            return unsupported(`Performance score ${workerScore} not sufficient for worker use with variant preference ${variantPreference}.`);\n          }\n\n          ;\n          return succeed('voicefocus-worker-sab-processor', 'worker-sab', variant);\n        }\n\n      case 'worker-postMessage':\n        {\n          const variant = resolveVariant(workerScore, variantPreference, thresholds.worker);\n\n          if (variant === 'failed') {\n            return unsupported(`Performance score ${workerScore} not sufficient for worker use.`);\n          }\n\n          ;\n\n          if (name === 'ns_es') {\n            const reason = 'Requested echo suppression but postMessage executor does not support it.';\n            logger === null || logger === void 0 ? void 0 : logger.warn(reason);\n            return {\n              supported: false,\n              reason\n            };\n          }\n\n          ;\n          return succeed('voicefocus-worker-postMessage-processor', 'worker-postMessage', variant);\n        }\n    }\n  };\n\n  return reducePreference(executionPreference);\n};\n\nconst featureCheck = (forceSIMD, fetchConfig, logger, estimator) => __awaiter(void 0, void 0, void 0, function* () {\n  const supports = {\n    supportsSIMD: forceSIMD,\n    supportsSAB: support_js_1.supportsSharedArrayBuffer(globalThis, window, logger),\n    duration: -1\n  };\n\n  if (forceSIMD) {\n    logger === null || logger === void 0 ? void 0 : logger.info('Supports SIMD: true (force)');\n    return supports;\n  }\n\n  const cleanup = !estimator;\n  const e = estimator || new Estimator(fetchConfig, logger);\n\n  try {\n    const useSIMD = !support_js_1.isOldChrome(window, logger) && (yield e.supportsSIMD());\n    logger === null || logger === void 0 ? void 0 : logger.info(`Supports SIMD: ${useSIMD} (force: ${forceSIMD})`);\n    supports.supportsSIMD = useSIMD;\n    return supports;\n  } finally {\n    if (cleanup) {\n      e.stop();\n    }\n  }\n});\n\nconst estimateAndFeatureCheck = (forceSIMD, fetchConfig, estimatorBudget, logger) => __awaiter(void 0, void 0, void 0, function* () {\n  const estimator = new Estimator(fetchConfig, logger);\n\n  try {\n    const supports = yield featureCheck(forceSIMD, fetchConfig, logger, estimator);\n\n    if (supports.supportsSIMD) {\n      try {\n        supports.duration = yield estimator.measure(true, estimatorBudget);\n        logger === null || logger === void 0 ? void 0 : logger.info('SIMD timing:', supports.duration);\n        return supports;\n      } catch (e) {\n        logger === null || logger === void 0 ? void 0 : logger.warn('Failed SIMD estimation; falling back to non-SIMD.');\n        supports.supportsSIMD = false;\n      }\n    }\n\n    supports.duration = yield estimator.measure(false, estimatorBudget);\n    logger === null || logger === void 0 ? void 0 : logger.info('No-SIMD timing:', supports.duration);\n    return supports;\n  } catch (e) {\n    logger === null || logger === void 0 ? void 0 : logger.error('Could not feature check.', e);\n    throw e;\n  } finally {\n    estimator.stop();\n  }\n});\n\nconst measureAndDecideExecutionApproach = function (spec, fetchConfig, logger) {\n  let thresholds = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : PERFORMANCE_THRESHOLDS;\n  return __awaiter(void 0, void 0, void 0, function* () {\n    let executionPreference = spec.executionPreference;\n    const {\n      usagePreference,\n      variantPreference,\n      namePreference,\n      simdPreference,\n      estimatorBudget,\n      executionQuantaPreference\n    } = spec;\n\n    if (usagePreference === 'interactivity' && executionPreference !== 'inline') {\n      logger === null || logger === void 0 ? void 0 : logger.debug(`Overriding execution preference ${executionPreference} to reflect interactivity preference.`);\n      executionPreference = 'inline';\n    }\n\n    const forceSIMD = simdPreference === 'force';\n    const knownModel = variantPreference !== 'auto';\n    const knownExecution = executionPreference !== 'auto';\n    let supports;\n\n    try {\n      if (knownModel && knownExecution) {\n        supports = yield featureCheck(forceSIMD, fetchConfig, logger);\n      } else {\n        supports = yield estimateAndFeatureCheck(forceSIMD, fetchConfig, estimatorBudget, logger);\n      }\n    } catch (e) {\n      logger === null || logger === void 0 ? void 0 : logger.error('Could not load estimator.', e);\n      throw new Error('Could not load Voice Focus estimator.');\n    }\n\n    return decideExecutionApproach(Object.assign(Object.assign({}, supports), {\n      simdPreference,\n      executionPreference,\n      variantPreference,\n      namePreference,\n      usagePreference,\n      executionQuantaPreference\n    }), thresholds, logger);\n  });\n};\n\nexports.measureAndDecideExecutionApproach = measureAndDecideExecutionApproach;\n\nconst decideModel = _ref2 => {\n  let {\n    category,\n    name,\n    variant,\n    simd,\n    url\n  } = _ref2;\n  return `${category}-${name}-${variant}-v1${simd ? '_simd' : ''}`;\n};\n\nexports.decideModel = decideModel;","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","decideModel","measureAndDecideExecutionApproach","loader_js_1","require","support_js_1","DEFAULT_EXECUTION_QUANTA","SIMD_SCORE_FIXED_POINT","WASM_SCORE_FIXED_POINT","SINGLE_INLINE_SCORE_MULTIPLIER","QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER","INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER","WORKER_SCORE_MULTIPLIER","PERFORMANCE_THRESHOLDS","wasm","noSupport","inline","c100","c50","c20","c10","worker","simd","Estimator","constructor","fetchConfig","logger","workerURL","paths","workers","fetchBehavior","headers","escapedQueryString","loadWorker","roundtrip","toSend","receive","expectedKey","listener","event","message","key","data","removeEventListener","addEventListener","postMessage","catch","_a","error","supportsSIMD","url","path","supports","measure","budget","benchWASM","benchSIMD","measurement","Error","stop","debug","terminate","inlineScoreMultiplier","executionQuanta","usagePreference","decideExecutionApproach","supportsSAB","duration","executionPreference","simdPreference","variantPreference","namePreference","executionQuantaPreference","allThresholds","forceSIMD","useSIMD","checkScores","baseScore","thresholds","inlineScore","workerScore","name","unsupported","reason","supported","succeed","processor","executionApproach","variant","undefined","resolveVariant","score","lookup","reducePreference","preference","inlineOption","workerOption","JSON","stringify","supportsSharedArrayBuffer","globalThis","window","warn","featureCheck","estimator","info","cleanup","isOldChrome","estimateAndFeatureCheck","estimatorBudget","spec","knownModel","knownExecution","assign","category"],"sources":["/Users/kshiba01/projects/DXサービス/AWS/amplify/amazon-ivs-chime-web-demo/web-ui/node_modules/amazon-chime-sdk-js/libs/voicefocus/decider.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decideModel = exports.measureAndDecideExecutionApproach = void 0;\nconst loader_js_1 = require(\"./loader.js\");\nconst support_js_1 = require(\"./support.js\");\nconst DEFAULT_EXECUTION_QUANTA = 3;\nconst SIMD_SCORE_FIXED_POINT = 2.50;\nconst WASM_SCORE_FIXED_POINT = 2.63;\nconst SINGLE_INLINE_SCORE_MULTIPLIER = 0.6;\nconst QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER = 0.65;\nconst INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER = 0.5;\nconst WORKER_SCORE_MULTIPLIER = 0.7;\nconst PERFORMANCE_THRESHOLDS = {\n    wasm: {\n        noSupport: 0.07,\n        inline: {\n            c100: 1,\n            c50: 0.36,\n            c20: 0.16,\n            c10: 0.07,\n        },\n        worker: {\n            c100: 0.5,\n            c50: 0.18,\n            c20: 0.08,\n            c10: 0.06,\n        },\n    },\n    simd: {\n        noSupport: 0.10,\n        inline: {\n            c100: 1,\n            c50: 0.43,\n            c20: 0.3,\n            c10: 0.2,\n        },\n        worker: {\n            c100: 0.5,\n            c50: 0.21,\n            c20: 0.15,\n            c10: 0.10,\n        },\n    },\n};\nclass Estimator {\n    constructor(fetchConfig, logger) {\n        this.fetchConfig = fetchConfig;\n        this.logger = logger;\n        const workerURL = `${fetchConfig.paths.workers}estimator-v1.js`;\n        this.fetchBehavior = { headers: fetchConfig.headers, escapedQueryString: fetchConfig.escapedQueryString };\n        this.worker = loader_js_1.loadWorker(workerURL, 'VoiceFocusEstimator', this.fetchBehavior, logger);\n    }\n    roundtrip(toSend, receive, expectedKey) {\n        return new Promise((resolve, reject) => {\n            this.worker.then(worker => {\n                let listener;\n                listener = (event) => {\n                    const { message, key } = event.data;\n                    if (message === receive && key === expectedKey) {\n                        worker.removeEventListener('message', listener);\n                        resolve(event.data);\n                    }\n                };\n                worker.addEventListener('message', listener);\n                worker.postMessage(toSend);\n            }).catch(e => {\n                var _a;\n                (_a = this.logger) === null || _a === void 0 ? void 0 : _a.error('Failed to load worker.', e);\n                reject(e);\n            });\n        });\n    }\n    supportsSIMD(url) {\n        const key = 'simd';\n        const path = url || `${this.fetchConfig.paths.wasm}simd-v1.wasm`;\n        const toSend = {\n            message: 'supports-simd',\n            fetchBehavior: this.fetchBehavior,\n            path,\n            key,\n        };\n        return this.roundtrip(toSend, 'simd-support', key)\n            .then(data => data.supports);\n    }\n    measure(simd, budget) {\n        const benchWASM = `${this.fetchConfig.paths.wasm}bench-v1.wasm`;\n        const benchSIMD = `${this.fetchConfig.paths.wasm}bench-v1_simd.wasm`;\n        const path = simd ? benchSIMD : benchWASM;\n        const key = `bench:${simd}`;\n        const toSend = {\n            message: 'measure',\n            fetchBehavior: this.fetchBehavior,\n            budget,\n            path,\n            key,\n        };\n        return this.roundtrip(toSend, 'measurement', key)\n            .then(data => {\n            if (data.measurement) {\n                return data.measurement;\n            }\n            throw new Error('Failed to measure.');\n        });\n    }\n    stop() {\n        this.worker.then(worker => {\n            var _a;\n            (_a = this.logger) === null || _a === void 0 ? void 0 : _a.debug('Stopping estimator worker.');\n            worker.terminate();\n        }).catch(e => {\n        });\n    }\n}\nconst inlineScoreMultiplier = (executionQuanta, usagePreference) => {\n    if (executionQuanta === 1) {\n        return SINGLE_INLINE_SCORE_MULTIPLIER;\n    }\n    if (usagePreference === 'quality') {\n        return QUALITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER * executionQuanta;\n    }\n    return INTERACTIVITY_MULTIPLE_QUANTA_SCORE_MULTIPLIER * executionQuanta;\n};\nconst decideExecutionApproach = ({ supportsSIMD, supportsSAB, duration, executionPreference = 'auto', simdPreference, variantPreference = 'auto', namePreference = 'default', usagePreference, executionQuantaPreference = DEFAULT_EXECUTION_QUANTA, }, allThresholds = PERFORMANCE_THRESHOLDS, logger) => {\n    const forceSIMD = (simdPreference === 'force');\n    const useSIMD = forceSIMD || (simdPreference !== 'disable' && supportsSIMD);\n    const checkScores = duration !== -1;\n    const baseScore = checkScores ? (useSIMD ? SIMD_SCORE_FIXED_POINT : WASM_SCORE_FIXED_POINT) / duration : 0;\n    const thresholds = useSIMD ? allThresholds.simd : allThresholds.wasm;\n    const inlineScore = checkScores ? inlineScoreMultiplier(executionQuantaPreference, usagePreference) * baseScore : 0;\n    const workerScore = checkScores ? WORKER_SCORE_MULTIPLIER * baseScore : 0;\n    const name = namePreference;\n    const unsupported = (reason) => {\n        return {\n            supported: false,\n            reason,\n        };\n    };\n    if (checkScores) {\n        if (baseScore < thresholds.noSupport) {\n            return unsupported(`Performance score ${baseScore} worse than threshold ${thresholds.noSupport}.`);\n        }\n    }\n    else {\n        if ((executionPreference === 'auto') ||\n            (variantPreference === 'auto')) {\n            return unsupported(`Missing explicit execution (${executionPreference}) or variant (${variantPreference}) preference, but no scoring performed.`);\n        }\n    }\n    logger === null || logger === void 0 ? void 0 : logger.debug(`Bench duration ${duration} yields inline score ${inlineScore} and worker score ${workerScore}.`);\n    const succeed = (processor, executionApproach, variant) => {\n        return {\n            supported: true,\n            useSIMD,\n            processor,\n            executionApproach,\n            variant,\n            executionQuanta: (executionApproach === 'inline' ? executionQuantaPreference : undefined),\n            name,\n        };\n    };\n    const resolveVariant = (score, variant, lookup) => {\n        if (variant !== 'auto') {\n            if (!checkScores || score > lookup[variant]) {\n                return variant;\n            }\n            return 'failed';\n        }\n        if (score > lookup.c100) {\n            return 'c100';\n        }\n        if (score > lookup.c50) {\n            return 'c50';\n        }\n        if (score > lookup.c20) {\n            return 'c20';\n        }\n        if (score > lookup.c10) {\n            return 'c10';\n        }\n        return 'failed';\n    };\n    const reducePreference = (preference) => {\n        switch (preference || 'auto') {\n            case 'auto': {\n                let inlineOption = reducePreference('inline');\n                let workerOption = reducePreference('worker');\n                logger === null || logger === void 0 ? void 0 : logger.debug(`Reducing auto preference: ${JSON.stringify(inlineOption)} vs ${JSON.stringify(workerOption)}`);\n                if (inlineOption.supported === false) {\n                    return workerOption;\n                }\n                if (workerOption.supported === false) {\n                    return workerOption;\n                }\n                if (inlineOption.variant === workerOption.variant || inlineOption.variant === 'c50') {\n                    return inlineOption;\n                }\n                return workerOption;\n            }\n            case 'worker': {\n                if (support_js_1.supportsSharedArrayBuffer(globalThis, window, logger)) {\n                    return reducePreference('worker-sab');\n                }\n                return reducePreference('worker-postMessage');\n            }\n            case 'inline': {\n                const variant = resolveVariant(inlineScore, variantPreference, thresholds.inline);\n                if (variant === 'failed') {\n                    return unsupported(`Performance score ${inlineScore} not sufficient for inline use with variant preference ${variantPreference}.`);\n                }\n                ;\n                return succeed('voicefocus-inline-processor', 'inline', variant);\n            }\n            case 'worker-sab': {\n                if (!supportsSAB) {\n                    const reason = 'Requested worker-sab but no SharedArrayBuffer support.';\n                    logger === null || logger === void 0 ? void 0 : logger.warn(reason);\n                    return { supported: false, reason };\n                }\n                const variant = resolveVariant(workerScore, variantPreference, thresholds.worker);\n                if (variant === 'failed') {\n                    return unsupported(`Performance score ${workerScore} not sufficient for worker use with variant preference ${variantPreference}.`);\n                }\n                ;\n                return succeed('voicefocus-worker-sab-processor', 'worker-sab', variant);\n            }\n            case 'worker-postMessage': {\n                const variant = resolveVariant(workerScore, variantPreference, thresholds.worker);\n                if (variant === 'failed') {\n                    return unsupported(`Performance score ${workerScore} not sufficient for worker use.`);\n                }\n                ;\n                if (name === 'ns_es') {\n                    const reason = 'Requested echo suppression but postMessage executor does not support it.';\n                    logger === null || logger === void 0 ? void 0 : logger.warn(reason);\n                    return { supported: false, reason };\n                }\n                ;\n                return succeed('voicefocus-worker-postMessage-processor', 'worker-postMessage', variant);\n            }\n        }\n    };\n    return reducePreference(executionPreference);\n};\nconst featureCheck = (forceSIMD, fetchConfig, logger, estimator) => __awaiter(void 0, void 0, void 0, function* () {\n    const supports = {\n        supportsSIMD: forceSIMD,\n        supportsSAB: support_js_1.supportsSharedArrayBuffer(globalThis, window, logger),\n        duration: -1,\n    };\n    if (forceSIMD) {\n        logger === null || logger === void 0 ? void 0 : logger.info('Supports SIMD: true (force)');\n        return supports;\n    }\n    const cleanup = !estimator;\n    const e = estimator || new Estimator(fetchConfig, logger);\n    try {\n        const useSIMD = !support_js_1.isOldChrome(window, logger) && (yield e.supportsSIMD());\n        logger === null || logger === void 0 ? void 0 : logger.info(`Supports SIMD: ${useSIMD} (force: ${forceSIMD})`);\n        supports.supportsSIMD = useSIMD;\n        return supports;\n    }\n    finally {\n        if (cleanup) {\n            e.stop();\n        }\n    }\n});\nconst estimateAndFeatureCheck = (forceSIMD, fetchConfig, estimatorBudget, logger) => __awaiter(void 0, void 0, void 0, function* () {\n    const estimator = new Estimator(fetchConfig, logger);\n    try {\n        const supports = yield featureCheck(forceSIMD, fetchConfig, logger, estimator);\n        if (supports.supportsSIMD) {\n            try {\n                supports.duration = yield estimator.measure(true, estimatorBudget);\n                logger === null || logger === void 0 ? void 0 : logger.info('SIMD timing:', supports.duration);\n                return supports;\n            }\n            catch (e) {\n                logger === null || logger === void 0 ? void 0 : logger.warn('Failed SIMD estimation; falling back to non-SIMD.');\n                supports.supportsSIMD = false;\n            }\n        }\n        supports.duration = yield estimator.measure(false, estimatorBudget);\n        logger === null || logger === void 0 ? void 0 : logger.info('No-SIMD timing:', supports.duration);\n        return supports;\n    }\n    catch (e) {\n        logger === null || logger === void 0 ? void 0 : logger.error('Could not feature check.', e);\n        throw e;\n    }\n    finally {\n        estimator.stop();\n    }\n});\nconst measureAndDecideExecutionApproach = (spec, fetchConfig, logger, thresholds = PERFORMANCE_THRESHOLDS) => __awaiter(void 0, void 0, void 0, function* () {\n    let executionPreference = spec.executionPreference;\n    const { usagePreference, variantPreference, namePreference, simdPreference, estimatorBudget, executionQuantaPreference, } = spec;\n    if (usagePreference === 'interactivity' && executionPreference !== 'inline') {\n        logger === null || logger === void 0 ? void 0 : logger.debug(`Overriding execution preference ${executionPreference} to reflect interactivity preference.`);\n        executionPreference = 'inline';\n    }\n    const forceSIMD = simdPreference === 'force';\n    const knownModel = variantPreference !== 'auto';\n    const knownExecution = executionPreference !== 'auto';\n    let supports;\n    try {\n        if (knownModel && knownExecution) {\n            supports = yield featureCheck(forceSIMD, fetchConfig, logger);\n        }\n        else {\n            supports = yield estimateAndFeatureCheck(forceSIMD, fetchConfig, estimatorBudget, logger);\n        }\n    }\n    catch (e) {\n        logger === null || logger === void 0 ? void 0 : logger.error('Could not load estimator.', e);\n        throw new Error('Could not load Voice Focus estimator.');\n    }\n    return decideExecutionApproach(Object.assign(Object.assign({}, supports), { simdPreference,\n        executionPreference,\n        variantPreference,\n        namePreference,\n        usagePreference,\n        executionQuantaPreference }), thresholds, logger);\n});\nexports.measureAndDecideExecutionApproach = measureAndDecideExecutionApproach;\nconst decideModel = ({ category, name, variant, simd, url }) => {\n    return `${category}-${name}-${variant}-v1${simd ? '_simd' : ''}`;\n};\nexports.decideModel = decideModel;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}